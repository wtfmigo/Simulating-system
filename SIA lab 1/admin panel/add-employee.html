<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Add Employee</title>
  <link rel="stylesheet" href="add-employee.css" />
</head>
<body>
  <div class="wrapper">
    <!-- Back to Dashboard -->
    <a href="indexLogin.html" class="back-btn">← Back to Dashboard</a>

    <div class="login-box">
      <div class="logo">
        <h2><span class="highlight">Add</span> Employee</h2>
      </div>

      <form id="employeeForm">
        <h3>Select Position</h3>
        <div class="position-buttons">
          <button type="button" id="adminBtn">Admin</button>
          <button type="button" id="cashierBtn">Cashier</button>
        </div>

        <div class="input-group">
          <label for="fullName">Full Name</label>
          <input type="text" id="fullName" required />
        </div>

        <div class="input-group auth-fields" style="display: none;">
          <label for="email">Email</label>
          <input type="text" id="email" />
        </div>

        <div class="input-group auth-fields" style="display: none;">
          <label for="password">Password</label>
          <input type="text" id="password" />
        </div>

        <div class="input-group">
          <label for="photo">Photo</label>
          <input type="file" id="photo" accept="image/*" required />
        </div>

        <button type="submit">Add Employee</button>
      </form>
    </div>

    <!-- Employee List -->
    <div class="employee-list">
      <h3>Employee List</h3>
      <ul id="employeeList"></ul>
    </div>
  </div>

  <script>
    let selectedPosition = "";

    const adminBtn = document.getElementById("adminBtn");
    const cashierBtn = document.getElementById("cashierBtn");
    const authFields = document.querySelectorAll(".auth-fields");

    adminBtn.addEventListener("click", () => {
      selectedPosition = "Admin";
      adminBtn.classList.add("selected");
      cashierBtn.classList.remove("selected");
      authFields.forEach(f => f.style.display = "block");
    });

    cashierBtn.addEventListener("click", () => {
      selectedPosition = "Cashier";
      cashierBtn.classList.add("selected");
      adminBtn.classList.remove("selected");
      authFields.forEach(f => f.style.display = "block");
    });

    document.getElementById("employeeForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const fullName = document.getElementById("fullName").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const photo = document.getElementById("photo").files[0];

      if (!fullName || !photo || !selectedPosition || !email || !password) {
        alert("Please fill out all fields.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function () {
        const employee = {
          fullName,
          email,
          password,
          position: selectedPosition,
          photo: reader.result,
          role: selectedPosition
        };

        const employees = JSON.parse(localStorage.getItem("employees") || "[]");
        employees.push(employee);
        localStorage.setItem("employees", JSON.stringify(employees));

        alert(`${fullName} (${selectedPosition}) added successfully!`);
        renderEmployeeList();
        document.getElementById("employeeForm").reset();
      };

      reader.readAsDataURL(photo);
    });

    function renderEmployeeList() {
      const employees = JSON.parse(localStorage.getItem("employees") || "[]");
      const list = document.getElementById("employeeList");
      list.innerHTML = "";

      employees.forEach((emp, index) => {
        const li = document.createElement("li");
        li.innerHTML = `
          <div class="employee-card">
            <img src="${emp.photo}" alt="Photo" class="employee-photo" />
            <div class="role-label">${emp.position}</div>
            <input type="text" value="${emp.fullName}" id="name-${index}" />
            <input type="text" value="${emp.email}" id="email-${index}" />
            <input type="text" value="${emp.password}" id="password-${index}" />
            <button onclick="updateEmployee(${index})">Update</button>
            <button class="delete" onclick="deleteEmployee(${index})">Delete</button>
          </div>
        `;
        list.appendChild(li);
      });
    }

    function updateEmployee(index) {
      const employees = JSON.parse(localStorage.getItem("employees") || "[]");
      const updatedName = document.getElementById(`name-${index}`).value.trim();
      const updatedEmail = document.getElementById(`email-${index}`).value.trim();
      const updatedPassword = document.getElementById(`password-${index}`).value.trim();

      if (!updatedName || !updatedEmail || !updatedPassword) {
        alert("All fields are required.");
        return;
      }

      employees[index].fullName = updatedName;
      employees[index].email = updatedEmail;
      employees[index].password = updatedPassword;

      localStorage.setItem("employees", JSON.stringify(employees));
      alert("✅ Employee updated!");
      renderEmployeeList();
    }

    function deleteEmployee(index) {
      if (!confirm("Delete this employee?")) return;

      const employees = JSON.parse(localStorage.getItem("employees") || "[]");
      employees.splice(index, 1);
      localStorage.setItem("employees", JSON.stringify(employees));
      renderEmployeeList();
    }

    document.addEventListener("DOMContentLoaded", renderEmployeeList);
  </script>
</body>
</html>
